(function(b){b.fn.editableAriaShim=function(){this.attr({role:"button",tabindex:0});return this};b.fn.editable=function(j,s){if("disable"===j){b(this).data("disabled.editable",true);return}if("enable"===j){b(this).data("disabled.editable",false);return}if("destroy"===j){b(this).unbind(b(this).data("event.editable")).removeData("disabled.editable").removeData("event.editable");return}var d=b.extend({},b.fn.editable.defaults,{target:j},s);var g=b.editable.types[d.type].plugin||function(){};var l=b.editable.types[d.type].submit||function(){};var n=b.editable.types[d.type].buttons||b.editable.types.defaults.buttons;var k=b.editable.types[d.type].content||b.editable.types.defaults.content;var e=b.editable.types[d.type].element||b.editable.types.defaults.element;var i=b.editable.types[d.type].reset||b.editable.types.defaults.reset;var p=b.editable.types[d.type].destroy||b.editable.types.defaults.destroy;var r=d.callback||function(){};var q=d.intercept||function(t){return t};var c=d.onedit||function(){};var f=d.onsubmit||function(){};var h=d.onreset||function(){};var m=d.onerror||i;var o=d.before||false;if(d.tooltip){b(this).attr("title",d.tooltip)}return this.each(function(){var t=this;b(this).data("event.editable",d.event);if(!b.trim(b(this).html())){b(this).html(d.placeholder)}if("destroy"===j){p.apply(b(this).find("form"),[d,t]);return}b(this).bind(d.event,function(A){if(true===b(this).data("disabled.editable")){return}if(A.keyCode===9){return}if(t.editing){return}if(false===c.apply(this,[d,t,A])){return}if(d.before&&jQuery.isFunction(d.before)){d.before()}else{if(d.before&&!jQuery.isFunction(d.before)){throw"The 'before' option needs to be provided as a function!"}}A.preventDefault();A.stopPropagation();if(d.tooltip){b(t).removeAttr("title")}if(b(this).html().toLowerCase().replace(/(;|"|\/)/g,"")===d.placeholder.toLowerCase().replace(/(;|"|\/)/g,"")){b(this).html("")}t.editing=true;t.revert=b(t).text();b(t).html("");var y=b("<form />");if(d.cssclass){if("inherit"===d.cssclass){y.attr("class",b(t).attr("class"))}else{y.attr("class",d.cssclass)}}if(d.style){if("inherit"===d.style){y.attr("style",b(t).attr("style"));y.css("display",b(t).css("display"))}else{y.attr("style",d.style)}}if(d.label){y.append("<label>"+d.label+"</label>")}if(d.formid){y.attr("id",d.formid)}var v=e.apply(y,[d,t]);if(d.inputcssclass){if("inherit"===d.inputcssclass){v.attr("class",b(t).attr("class"))}else{v.attr("class",d.inputcssclass)}}var u;var x;if(d.loadurl){x=t.setTimeout(function(){v.disabled=true},100);b(t).html(d.loadtext);var w={};w[d.id]=t.id;if(b.isFunction(d.loaddata)){b.extend(w,d.loaddata.apply(t,[t.revert,d]))}else{b.extend(w,d.loaddata)}b.ajax({type:d.loadtype,url:d.loadurl,data:w,async:false,cache:false,success:function(B){t.clearTimeout(x);u=B;v.disabled=false}})}else{if(d.data){u=d.data;if(b.isFunction(d.data)){u=d.data.apply(t,[t.revert,d])}}else{u=t.revert}}k.apply(y,[u,d,t]);v.attr("name",d.name);if(d.width!=="none"){var z=d.width-(v.outerWidth(true)-d.width);v.width(z)}n.apply(y,[d,t]);if(d.showfn&&b.isFunction(d.showfn)){y.hide()}b(t).html("");b(t).append(y);if(d.showfn&&b.isFunction(d.showfn)){d.showfn(y)}g.apply(y,[d,t]);y.find(":input:visible:enabled:first").focus();if(d.select){v.select()}v.keydown(function(B){if(B.keyCode===27){B.preventDefault();i.apply(y,[d,t])}});if("cancel"===d.onblur){v.blur(function(B){x=t.setTimeout(function(){i.apply(y,[d,t])},500)})}else{if("submit"===d.onblur){v.blur(function(B){x=t.setTimeout(function(){y.submit()},200)})}else{if(b.isFunction(d.onblur)){v.blur(function(B){if(false===d.onblur.apply(t,[v.val(),d,y])){i.apply(y,[d,t])}})}}}y.submit(function(E){if(x){t.clearTimeout(x)}E.preventDefault();if(false!==f.apply(y,[d,t])){if(false!==l.apply(y,[d,t])){if(b.isFunction(d.target)){var B=function(G){b(t).html(G);t.editing=false;r.apply(t,[t.innerHTML,d]);if(!b.trim(b(t).html())){b(t).html(d.placeholder)}};var F=d.target.apply(t,[v.val(),d,B]);if(false!==F&&undefined!==F){B(F)}}else{var D={};D[d.name]=v.val();D[d.id]=t.id;if(b.isFunction(d.submitdata)){b.extend(D,d.submitdata.apply(t,[t.revert,d,D]))}else{b.extend(D,d.submitdata)}if("PUT"===d.method){D._method="put"}b(t).html(d.indicator);var C={type:"POST",data:D,dataType:"html",url:d.target,success:function(G,H){G=q.apply(t,[G,H]);if(C.dataType==="html"){b(t).html(G)}t.editing=false;r.apply(t,[G,d,D]);if(!b.trim(b(t).html())){b(t).html(d.placeholder)}},error:function(I,G,H){m.apply(y,[d,t,I])}};b.extend(C,d.ajaxoptions);b.ajax(C)}}}b(t).attr("title",d.tooltip);return false})});t.reset=function(u){if(t.editing){if(false!==h.apply(u,[d,t])){b(t).html(t.revert);t.editing=false;if(!b.trim(b(t).html())){b(t).html(d.placeholder)}if(d.tooltip){b(t).attr("title",d.tooltip)}}}};t.destroy=function(u){b(t).unbind(b(t).data("event.editable")).removeData("disabled.editable").removeData("event.editable");t.clearTimeouts();if(t.editing){i.apply(u,[d,t])}};t.clearTimeout=function(w){var u=b(t).data("timeouts");clearTimeout(w);if(u){var v=u.indexOf(w);if(v>-1){u.splice(v,1);if(u.length<=0){b(t).removeData("timeouts")}}else{console.warn("jeditable clearTimeout could not find timeout "+w)}}};t.clearTimeouts=function(){var u=b(t).data("timeouts");if(u){for(var v=0,w=u.length;v<w;++v){clearTimeout(u[v])}u.length=0;b(t).removeData("timeouts")}};t.setTimeout=function(x,w){var u=b(t).data("timeouts");var v=setTimeout(function(){x();t.clearTimeout(v)},w);if(!u){u=[];b(t).data("timeouts",u)}u.push(v);return v}})};var a=function(d){var c=document.createElement("input");c.setAttribute("type",d);return c.type!=="text"?d:"text"};b.editable={types:{defaults:{element:function(e,d){var c=b('<input type="hidden"></input>');b(this).append(c);return(c)},content:function(c,e,d){b(this).find(":input:first").val(c)},reset:function(d,c){c.reset(this)},destroy:function(d,c){c.destroy(this)},buttons:function(d,c){var f=this;var g;if(d.submit){if(d.submit.match(/>$/)){g=b(d.submit).click(function(){if(g.attr("type")!=="submit"){f.submit()}})}else{g=b('<button type="submit" />');g.html(d.submit);if(d.submitcssclass){g.addClass(d.submitcssclass)}}b(this).append(g)}if(d.cancel){var e;if(d.cancel.match(/>$/)){e=b(d.cancel)}else{e=b('<button type="cancel" />');e.html(d.cancel);if(d.cancelcssclass){e.addClass(d.cancelcssclass)}}b(this).append(e);b(e).click(function(i){var h;if(b.isFunction(b.editable.types[d.type].reset)){h=b.editable.types[d.type].reset}else{h=b.editable.types.defaults.reset}h.apply(f,[d,c]);return false})}}},text:{element:function(e,d){var c=b("<input />").attr({autocomplete:"off",list:e.list,maxlength:e.maxlength,pattern:e.pattern,placeholder:e.placeholder,tooltip:e.tooltip,type:"text"});if(e.width!=="none"){c.css("width",e.width)}if(e.height!=="none"){c.css("height",e.height)}if(e.size){c.attr("size",e.size)}if(e.maxlength){c.attr("maxlength",e.maxlength)}b(this).append(c);return(c)}},textarea:{element:function(e,d){var c=b("<textarea></textarea>");if(e.rows){c.attr("rows",e.rows)}else{if(e.height!=="none"){c.height(e.height)}}if(e.cols){c.attr("cols",e.cols)}else{if(e.width!=="none"){c.width(e.width)}}if(e.maxlength){c.attr("maxlength",e.maxlength)}b(this).append(c);return(c)}},select:{element:function(e,d){var c=b("<select />");if(e.multiple){c.attr("multiple","multiple")}b(this).append(c);return(c)},content:function(f,e,d){var m;if(String===f.constructor){m=JSON.parse(f)}else{m=f}var j=[];var l;for(l in m){j.push([l,m[l]])}j.sort(function(n,i){n=n[1];i=i[1];return n<i?-1:(n>i?1:0)});var h;for(var g=0;g<j.length;g++){l=j[g][0];var k=j[g][1];if(!m.hasOwnProperty(l)){continue}if(l!=="selected"){h=b("<option />").val(l).append(k)}if(l==="selected"||l===b.trim(d.revert)){b(h).prop("selected","selected")}b(this).find("select").append(h)}if(!e.submit){var c=this;b(this).find("select").change(function(){c.submit()})}}},number:{element:function(e,d){var c=b("<input />").attr({maxlength:e.maxlength,placeholder:e.placeholder,min:e.min,max:e.max,step:e.step,tooltip:e.tooltip,type:a("number")});if(e.width!=="none"){c.css("width",e.width)}b(this).append(c);return c}},email:{element:function(e,d){var c=b("<input />").attr({maxlength:e.maxlength,placeholder:e.placeholder,tooltip:e.tooltip,type:a("email")});if(e.width!=="none"){c.css("width",e.width)}b(this).append(c);return c}},url:{element:function(e,d){var c=b("<input />").attr({maxlength:e.maxlength,pattern:e.pattern,placeholder:e.placeholder,tooltip:e.tooltip,type:a("url")});if(e.width!=="none"){c.css("width",e.width)}b(this).append(c);return c}}},addInputType:function(d,c){b.editable.types[d]=c}};b.fn.editable.defaults={name:"value",id:"id",type:"text",width:"auto",height:"auto",event:"click.editable keydown.editable",onblur:"cancel",tooltip:"Click to edit",loadtype:"GET",loadtext:"Loading...",placeholder:"Click to edit",loaddata:{},submitdata:{},ajaxoptions:{}}})(jQuery);